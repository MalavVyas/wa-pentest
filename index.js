const wa = require('@open-wa/wa-automate');
var request = require('request');

const fs = require('fs-extra');
const {exec} = require('child_process');
const {stat} = require('fs');
const { group } = require('console');
const uaOverride = 'WhatsApp/2.2029.4 Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4103.116 Safari/ 537.36'
wa.create().then(client => start(client))
function start(client){
    client.onMessage(async message => {
        const {type, id, from, t, sender, isGroupMsg, chat, caption, isMedia, mimetype, quotedMsg, quotedMsgObj, mentionedJidList } = message
        const groupId = isGroupMsg ? chat.groupMetadata.id : "";
        const groupAdmins = isGroupMsg ? groupAdmins.includes(sender.id) : false
        const isBotGroupAdmins = isGroupMsg ? groupAdmins.includes("919429632133" + '@c.us') : false
        const {name, formattedTitle } = chat
        let { body } = message
        const commands = caption || body || ''
        const command = commands.toLowerCase().split(' ')[0] || ''

        if(command === '#nmap'){
            console.log(message.body)
            const args = message.body.split(' ')
            console.log("nmap" + args +"-oN result.txt");
            console.log(args);
            try{
                exec("nmap " + args[1] + " -oN result.txt", (error, stdout, stderr) => {
                    if (error) {
                        console.log(`error: ${error.message}`);
                        return;
                    }
                    if (stderr) {
                        console.log(`stderr: ${stderr}`);
                        return;
                    }
                    client.sendFile(from, "./result.txt", "result.txt", id)
                    console.log(`stdout: ${stdout}`);
                });
            } catch(error) {
                console.error(error)
            }

        }
    } )
}